require.config({baseUrl:"",paths:{wf:"../js/wfQuery"}}),require(["wf"],function(e){function t(t){for(var o=0;o<t.length;o++){if(!/\bimage\b/.test(t[o].type))return alert("文件必须为图片"),!1;!function(t){var o=new FileReader;o.onload=function(t){n.append(e('<li class="item"><img src="'+t.target.result+'" alt="3" /></li>'))},o.readAsDataURL(t)}(t[o])}}var n=e("#main-screen"),o=e("#files"),i=(document.createElement("form"),e('<div class="edit-holder" style="display:none" tabindex="2" title="1.拖拽改变图片位置;\n2.滚轮改变图片大小;\n3.del/backspace键删除;\n4.点击select调整大小。"></div>'));i.html('<select>    <option value="size-1-1">1:1</option>    <option value="size-1_5-1">1.5:1</option>    <option value="size-2-2">2:2</option>    <option value="size-3-2" selected>3:2[默认]</option>    <option value="size-3-3">3:3</option>    <option value="size-6-4">6:4</option></select>'),e(document.body).append(i),e(document).on("dragenter dragover drop dragleave",function(e){e.preventDefault()}),n.on("drop",function(e){e.preventDefault();var n=e.dataTransfer.files;return 0==n.length?!1:void t(n)}),o.on("change",function(){t(this.files)});var l=null;i.refresh=function(){l&&i.css(l.parentNode.getBoundingClientRect()).show().trigger("focus")},e(window).on("resize",i.refresh),n.on("dblclick",".item",function(){l=this.children[0],r.val(l.size||"size-3-2"),i.refresh()}).on("click",".item",function(){i.hide(),l=null}),i.on("dblclick",function(){i.hide(),l=null});var r=i.children("select");r.on("change",function(){l.parentNode.className="item "+this.value,l.size=this.value,i.refresh()}),i.on("keyup",function(t){(8===t.keyCode||46===t.keyCode)&&(e(l.parentNode).remove(),i.hide(),l=null,t.preventDefault(),t.stopPropagation())}),i.on("mousewheel",function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(l.style.width||"100%");e.wheelDelta>0?t+=5:t-=5,l.style.width=t+"%"});var s=null;i.on("mousedown",function(e){return s={left:parseFloat(l.style.left)||0,top:parseFloat(l.style.top)||0,e:{x:e.x,y:e.y}},!1}).on("mousemove",function(t){var n;(n=s)&&e(l).css({left:n.left+t.x-n.e.x+"px",top:n.top+t.y-n.e.y+"px"})}).on("mouseup mouseout mouseleave",function(){return s=null,!1});var a=null;n.on("dragstart",".item",function(){a=this,i.hide()}).on("drop",".item",function(){if(this!==a){var e=n.children();e.indexOf(this)>e.indexOf(a)?this.nextElementSibling?this.parentNode.insertBefore(a,this.nextElementSibling):this.parentNode.appendChild(a):this.parentNode.insertBefore(a,this)}})});